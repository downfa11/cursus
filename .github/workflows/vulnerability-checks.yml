name: Security and Code Health Checks

on:
  push:
    branches: [main, release-*]
  pull_request:
    branches: [main]

jobs:
  dependency_review:
    name: ğŸ›¡ï¸ Dependency Vulnerability Review
    runs-on: ubuntu-latest
    permissions:
      contents: read
    steps:
      - name: Checkout Code
        uses: actions/checkout@v4
      - name: Dependency Review
        uses: actions/dependency-review-action@v4

  secret_scan:
    name: ğŸ”‘ Secret Leak Detection
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0 
      
      - name: Run TruffleHog Secret Scanner
        uses: trufflesecurity/trufflehog@v3.90.13
        with:
          path: ./
          base: ${{ github.event.pull_request.base.sha }}
          head: ${{ github.sha }}
          extra_args: --fail --no-detectors git_repo